(function(c){c.widget("awnry.pickList",{options:{mainClass:"pickList",listContainerClass:"pickList_listContainer",sourceListContainerClass:"pickList_sourceListContainer",controlsContainerClass:"pickList_controlsContainer",targetListContainerClass:"pickList_targetListContainer",listClass:"pickList_list",sourceListClass:"pickList_sourceList",targetListClass:"pickList_targetList",clearClass:"pickList_clear",listItemClass:"pickList_listItem",richListItemClass:"pickList_richListItem",selectedListItemClass:"pickList_selectedListItem",
addAllClass:"pickList_addAll",addClass:"pickList_add",removeAllClass:"pickList_removeAll",removeClass:"pickList_remove",addAllLabel:"&gt;&gt;",addLabel:"&gt;",removeAllLabel:"&lt;&lt;",removeLabel:"&lt;",listLabelClass:"pickList_listLabel",sourceListLabel:"Available",sourceListLabelClass:"pickList_sourceListLabel",targetListLabel:"Selected",targetListLabelClass:"pickList_targetListLabel",sortItems:!0,sortAttribute:"label",items:[],richItems:[]},_create:function(){this._buildPickList();this._refresh()},
_buildPickList:function(){this.pickList=c("<div/>").hide().addClass(this.options.mainClass).insertAfter(this.element).append(this._buildSourceList()).append(this._buildControls()).append(this._buildTargetList()).append(c("<div/>").addClass(this.options.clearClass));this._populateLists();this.element.hide();this.pickList.show()},_buildSourceList:function(){var a=c("<div/>").addClass(this.options.listContainerClass).addClass(this.options.sourceListContainerClass).css({"-moz-user-select":"none","-webkit-user-select":"none",
"user-select":"none","-ms-user-select":"none"}).each(function(){this.onselectstart=function(){return!1}}),b=c("<div/>").text(this.options.sourceListLabel).addClass(this.options.listLabelClass).addClass(this.options.sourceListLabelClass);this.sourceList=c("<ul/>").addClass(this.options.listClass).addClass(this.options.sourceListClass).delegate("li","click",{pickList:this},this._changeHandler);a.append(b).append(this.sourceList);return a},_buildTargetList:function(){var a=c("<div/>").addClass(this.options.listContainerClass).addClass(this.options.targetListContainerClass).css({"-moz-user-select":"none",
"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none"}).each(function(){this.onselectstart=function(){return!1}}),b=c("<div/>").text(this.options.targetListLabel).addClass(this.options.listLabelClass).addClass(this.options.targetListLabelClass);this.targetList=c("<ul/>").addClass(this.options.listClass).addClass(this.options.targetListClass).delegate("li","click",{pickList:this},this._changeHandler);a.append(b).append(this.targetList);return a},_buildControls:function(){this.controls=
c("<div/>").addClass(this.options.controlsContainerClass);this.addAllButton=c("<button type='button'/>").click({pickList:this},this._addAllHandler).html(this.options.addAllLabel).addClass(this.options.addAllClass);this.addButton=c("<button type='button'/>").click({pickList:this},this._addHandler).html(this.options.addLabel).addClass(this.options.addClass);this.removeButton=c("<button type='button'/>").click({pickList:this},this._removeHandler).html(this.options.removeLabel).addClass(this.options.removeClass);
this.removeAllButton=c("<button type='button'/>").click({pickList:this},this._removeAllHandler).html(this.options.removeAllLabel).addClass(this.options.removeAllClass);this.controls.append(this.addAllButton).append(this.addButton).append(this.removeButton).append(this.removeAllButton);return this.controls},_populateLists:function(){var a=this;a.element.children().each(function(){var b=c(this).text(),b=c("<li/>").text(b).val(c(this).val()).attr("label",b).addClass(a.options.listItemClass);"selected"==
c(this).attr("selected")?a.targetList.append(b):a.sourceList.append(b)});c(a.options.items).each(function(){a.insert(this)});c(a.options.richItems).each(function(){a.insert(this)})},_addItem:function(a){var b=this;b.sourceList.children("[value='"+a+"']").each(function(){b.targetList.append(b._removeSelection(c(this)))});b.element.children("[value='"+a+"']").each(function(){c(this).attr("selected","selected")})},_removeItem:function(a){var b=this;b.targetList.children("[value='"+a+"']").each(function(){b.sourceList.append(b._removeSelection(c(this)))});
b.element.children("[value='"+a+"']").each(function(){c(this).removeAttr("selected")})},_addAllHandler:function(a){var b=a.data.pickList;b.sourceList.children().each(function(){b._addItem(c(this).val())});b._refresh()},_addHandler:function(a){var b=a.data.pickList;b.sourceList.children(".ui-selected").each(function(){b._addItem(c(this).val())});b._refresh()},_removeHandler:function(a){var b=a.data.pickList;b.targetList.children(".ui-selected").each(function(){b._removeItem(c(this).val())});b._refresh()},
_removeAllHandler:function(a){var b=a.data.pickList;b.targetList.children().each(function(){b._removeItem(c(this).val())});b._refresh()},_refresh:function(){this.sourceList.children().length?this.addAllButton.removeAttr("disabled"):this.addAllButton.attr("disabled","disabled");this.targetList.children().length?this.removeAllButton.removeAttr("disabled"):this.removeAllButton.attr("disabled","disabled");this.sourceList.children(".ui-selected").length?this.addButton.removeAttr("disabled"):this.addButton.attr("disabled",
"disabled");this.targetList.children(".ui-selected").length?this.removeButton.removeAttr("disabled"):this.removeButton.attr("disabled","disabled");this.options.sortItems&&(this._sortItems(this.sourceList,this.options),this._sortItems(this.targetList,this.options))},_sortItems:function(a,b){var d=[];a.children().each(function(){d.push(c(this))});d.sort(function(a,c){return a.attr(b.sortAttribute)>c.attr(b.sortAttribute)?1:a.attr(b.sortAttribute)==c.attr(b.sortAttribute)?0:-1});a.empty();for(var e=
0;e<d.length;e++)a.append(d[e])},_changeHandler:function(a){var b=a.data.pickList;if(a.ctrlKey)b._isSelected(c(this))?b._removeSelection(c(this)):(b.lastSelectedItem=c(this),b._addSelection(c(this)));else if(a.shiftKey){var d=c(this).val(),e=b.lastSelectedItem.val();c(this).index()<c(b.lastSelectedItem).index()&&(a=d,d=e,e=a);var f=!1,g=!0;b._clearSelections(c(this).parent());c(this).parent().children().each(function(){c(this).val()==e&&(f=true);f&&g&&b._addSelection(c(this));c(this).val()==d&&(g=
false)})}else b.lastSelectedItem=c(this),b._clearSelections(c(this).parent()),b._addSelection(c(this));b._refresh()},_isSelected:function(a){return a.hasClass("ui-selected")},_addSelection:function(a){return a.addClass("ui-selected").addClass("ui-state-highlight").addClass(this.options.selectedListItemClass)},_removeSelection:function(a){return a.removeClass("ui-selected").removeClass("ui-state-highlight").removeClass(this.options.selectedListItemClass)},_clearSelections:function(a){var b=this;a.children().each(function(){b._removeSelection(c(this))})},
_setOption:function(a,b){c.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){this.pickList.remove();this.element.show();c.Widget.prototype.destroy.call(this)},insert:function(a){var b=a.selected?this.targetList:this.sourceList,c=this._createSelectItem(a),a=void 0==a.element?this._createRegularItem(a):this._createRichItem(a);this.element.append(c);b.append(a);this._refresh()},_createSelectItem:function(a){var b=c("<option/>").val(a.value).text(a.label);a.selected&&b.attr("selected",
"selected");return b},_createRegularItem:function(a){return c("<li/>").val(a.value).text(a.label).attr("label",a.label).addClass(this.options.listItemClass)},_createRichItem:function(a){return c("<li/>").val(a.value).attr("label",a.label).addClass(this.options.listItemClass).addClass(this.options.richListItemClass).append(a.element)}})})(jQuery);